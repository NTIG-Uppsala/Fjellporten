<!DOCTYPE html>
<html lang="sv">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adminpanel</title>
  <link rel="stylesheet" href="/admin/panel_styles.css">
</head>

<body>
  <h1>Alla Bilar</h1>
  
  <table>
    <thead>
      <tr>
        <th>Bilmodell</th>
        <th>Typ</th>
        <th>Info</th>
        <th>Kostnad</th>
        <th>Redigera</th>
        <th>Ta bort</th>
      </tr>
    </thead>
    <tbody>
      <% if (cars && cars.length > 0) { %>
        <% cars.forEach(car => { %>
          <tr>
            <td><strong><%= car.car_name %></strong></td>
            <td>
              <% const typeNames = { small_car: 'Liten bil', big_car: 'Stor bil', caravan: 'Husbil' }; %>
              <%= typeNames[car.car_type] %>
            </td>
            <td>
              <% if (car.car_type !== 'caravan') { %>
                Lastutrymme: <%= car.cargo_space %>L
              <% } else { %>
                Sängar: <%= car.beds %>st
              <% } %>
            </td>
            <td><%= car.cost %> kr/dag</td>
            <td><button class="editBtn" data-id="<%= car.id %>">Redigera</button></td>
            <td>
              <form action="/admin/delete-car" method="POST" style="display:inline;">
                <input type="hidden" name="id" value="<%= car.id %>">
                <button type="submit" onclick="return confirm('Är du säker på att du vill ta bort denna bil?')">Ta bort</button>
              </form>
            </td>
          </tr>

          <!-- Edit row -->
          <tr id="editRow-<%= car.id %>" class="editRow">
            <td colspan="6">
              <form action="/admin/edit-car" method="POST">
                <input type="hidden" name="id" value="<%= car.id %>">

                <select name="car_type" required>
                  <option value="small_car" <%= car.car_type === 'small_car' ? 'selected' : '' %>>Liten bil</option>
                  <option value="big_car" <%= car.car_type === 'big_car' ? 'selected' : '' %>>Stor bil</option>
                  <option value="caravan" <%= car.car_type === 'caravan' ? 'selected' : '' %>>Husbil</option>
                </select>

                <input type="text" name="car_name" value="<%= car.car_name %>" placeholder="Bilmodell" required>
                <input type="number" name="cargo_space" value="<%= car.cargo_space != null ? car.cargo_space : '' %>" placeholder="Lastutrymme">
                <input type="number" name="beds" value="<%= car.beds != null ? car.beds : '' %>" placeholder="Sängar">
                <input type="number" name="cost" value="<%= car.cost != null ? car.cost : '' %>" placeholder="Kostnad/dag" required>

                <button type="submit">Spara</button>
                <button type="button" class="cancelBtn" data-id="<%= car.id %>">Avbryt</button>
              </form>
            </td>
          </tr>
        <% }) %>
      <% } else { %>
        <tr><td colspan="6">Inga bilar hittades</td></tr>
      <% } %>
    </tbody>
  </table>

  <!-- Add new car -->
  <h2>Lägg till en ny bil</h2>
  <form action="/admin/add-car" method="POST">
    <select name="car_type" required>
      <option value="small_car">Liten bil</option>
      <option value="big_car">Stor bil</option>
      <option value="caravan">Husbil</option>
    </select>
    <input type="text" name="car_name" placeholder="Bilmodell" required>
    <input type="number" name="cargo_space" placeholder="Lastutrymme">
    <input type="number" name="beds" placeholder="Sängar">
    <input type="number" name="cost" placeholder="Kostnad/dag" required>
    <button type="submit">Lägg till bil</button>
  </form>

  <script>
    // Event delegation for edit/cancel buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('editBtn')) {
        const id = e.target.dataset.id;
        const row = document.getElementById('editRow-' + id);
        if (row) row.style.display = row.style.display === 'table-row' ? 'none' : 'table-row';
      }

      if (e.target.classList.contains('cancelBtn')) {
        const id = e.target.dataset.id;
        const row = document.getElementById('editRow-' + id);
        if (row) row.style.display = 'none';
      }
    });
  </script>
</body>
</html>