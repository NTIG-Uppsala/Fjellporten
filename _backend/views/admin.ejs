<!DOCTYPE html>
<html>
<head>
  <title>Fjellporten adminpanel</title>
</head>
<body>
  <h1>Alla Bilar</h1>

  <!-- Lista alla bilar -->
  <ul>
    <% if (cars && cars.length > 0) { %>
      <% cars.forEach(car => { %>
        <li>
          <strong><%= car.car_name %></strong> 
          (<%= car.car_type %>) 
          <% if (car.car_type !== 'caravan') { %>
            - Lastutrymme: <%= car.cargo_space %>L
          <% } %>
          <% if (car.car_type === 'caravan') { %>
            - Sängar: <%= car.beds %>st
          <% } %>
          - Kostnad: <%= car.cost %> kr/dag

          <!-- Edit button -->
          <button class="editBtn" data-id="<%= car.id %>">Redigera</button>

          <!-- Edit form (hidden initially) -->
          <form id="editForm-<%= car.id %>" action="/edit-car" method="POST" style="display:none; margin-top:5px;">
            <input type="hidden" name="id" value="<%= car.id %>">
            <select name="car_type" required>
                <option value="small_car" <%= car.car_type === 'small_car' ? 'selected' : '' %>>Liten bil</option>
                <option value="big_car" <%= car.car_type === 'big_car' ? 'selected' : '' %>>Stor bil</option>
                <option value="caravan" <%= car.car_type === 'caravan' ? 'selected' : '' %>>Husbil</option>
            <input type="text" name="car_name" value="<%= car.car_name %>" required placeholder="Bilmodell">
            <input type="number" name="cargo_space" value="<%= car.cargo_space != null ? car.cargo_space : '' %>" placeholder="Lastutrymme">
            <input type="number" name="beds" value="<%= car.beds != null ? car.beds : '' %>" placeholder="Sängar">
            <input type="number" name="cost" value="<%= car.cost != null ? car.cost : '' %>" placeholder="Kostnad/dag">
            <button type="submit">Spara</button>
            <button type="button" class="cancel-btn" data-id="<%= car.id %>">Avbryt</button>
          </form>

          <!-- Delete button -->
          <form action="/delete-car" method="POST" style="display:inline;">
            <input type="hidden" name="id" value="<%= car.id %>">
            <button type="submit" onclick="return confirm('Är du säker på att du vill ta bort denna bil?')">Ta bort</button>
          </form>
        </li>
      <% }) %>
    <% } else { %>
      <li>Inga bilar hittades</li>
    <% } %>
  </ul>

  <!-- Lägg till ny bil -->
  <h2>Lägg till en ny bil</h2>
  <form action="/add-car" method="POST">
    <select name="car_type" placeholder="Biltyp" required>
        <option value="small_car">Liten bil</option>
        <option value="big_car">Stor bil</option>
        <option value="caravan">Husbil</option>
    <input type="text" name="car_name" placeholder="Bilmodell" required>
    <input type="number" name="cargo_space" placeholder="Lastutrymme">
    <input type="number" name="beds" placeholder="Sängar">
    <input type="number" name="cost" placeholder="Kostnad/dag">
    <button type="submit">Lägg till bil</button>
  </form>

  <!-- Script för att visa/dölja redigeringsformulär -->
  <script>
    // Visa redigeringsformulär
    document.querySelectorAll('.editBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const form = document.getElementById('editForm-' + id);
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
      });
    });

    // Dölj redigeringsformulär (avbryt)
    document.querySelectorAll('.cancelBtn').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.dataset.id;
        const form = document.getElementById('editForm-' + id);
        form.style.display = 'none';
      });
    });
  </script>
</body>
</html>